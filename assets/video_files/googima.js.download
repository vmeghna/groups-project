!function(){"use strict";const e="googima",t="TYPE_API",s="TYPE_SCHEDULE",i="jw-flag-ads-googleima",n="jw-flag-ads-vpaid",a="jw-flag-ads-vpaid-controls",r="playing",o="adError",l="adItem",d="adStarted",h="viewable",u="external",c=u,p="vast",g="googima",m="vmap",y="-1",f="adBreakIgnored",v="adError",A="__jwpseg__",P="instream",w="article",b={[[P]]:1,[["banner"]]:2,[[w]]:3,[["feed"]]:4,[["floating"]]:5,[["interstitial"]]:5,[["slider"]]:5},E=function(e,t,s,i){if(0!==i.indexOf(e))return!1;const n=parseFloat(i.slice(e.length));return!(n<t||n>s)&&n},_=E.bind(null,"800000",10,90),k=E.bind(null,"900000",10,90),M=E.bind(null,"JWIAB",1,999);var C=function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");return Object.prototype.hasOwnProperty.call(Object(e),t)};const I=/^[^:/?#]+:?\/\/[^/?#]+/,R=function(e,t){if(!e)return;if(!t)return e;let s,i="",n="";Object.keys(t).forEach((e=>{const s=t[e];i=`${i}${n}${e}=${s}`,n="&"}));const a=(e=>{if(e)return new URL(e,window.location)})(e),r=a.pathname;return a.searchParams.has("cust_params")?a.searchParams.set("cust_params",`${i}&${a.searchParams.getAll("cust_params")}`):a.searchParams.set("cust_params",i),s=a.toString(),0===e.indexOf("./")?s=`.${s.substring(s.indexOf(r))}`:0===e.indexOf("../")?s=`..${s.substring(s.indexOf(r))}`:0!==e.indexOf(`${a.protocol}`)||e.includes("://")?0===e.indexOf("//")?s=s.replace(a.protocol,""):0!==e.indexOf("//")&&0===e.indexOf("/")?s=s.substring(s.indexOf(r)):0!==e.indexOf("/")&&0===e.indexOf(a.pathname.substring(1))&&(s=s.substring(s.indexOf(r)+1)):s=s.replace("://",":"),s},S=e=>e?new URL(e).hostname:"",j=(e,t=document.location.search)=>{if(e)return new URLSearchParams(t).getAll(e)},L="hb_jwvb",T="hb_jwcr",x={[[L]]:"VIEWABILITY",[[T]]:"COMPLETION_RATE",[["hb_jwiab"]]:"IAB_CONTEXTUAL",[["hb_jwbs"]]:"BRAND_SAFETY"},B=[L,T],D=/^(https?:\/\/).*.(?:ampproject.org|bing-amp.com)\/(?:.\/)*(.*)\/amp.*$/,O=function(){if(!((e,t)=>{if(e)return new URLSearchParams(e).has(t)})(document.location.search,"isAMP"))return;const e=j("consentValue").join(),t=j("consentGdpr").join();return e||t?{gdprApplies:t,consentData:e}:void 0},q=Date.now||function(){return(new Date).getTime()},U=e=>{const t=(e=>{let t=window;for(;t;){try{if(t.frames[e])break}catch(e){}t=t===window.top?null:t.parent}return t})(`${e}Locator`);return null!==t&&function(s,i,n,a){const r=q(),o=t=>{let s=t?t.data:{};if("string"==typeof s)try{s=JSON.parse(s)}catch(e){s={}}const i=`${e}Return`;s[i]&&s[i].callId===r&&(removeEventListener("message",o),n(s[i].returnValue,s[i].success))};window.addEventListener("message",o,!1);const l={[[`${e}Call`]]:{command:s,callId:r,parameter:a,[[void 0!==a?"version":"parameter"]]:i}};t.postMessage(JSON.stringify(l),"*")}};let V=null,N={gdprApplies:!0,consentData:""};const H=function(e=1e3){return null===V&&(V=new Promise((e=>{const t=window.__tcfapi||U("__tcfapi");if(t)return t("getTCData",2,((t,s)=>{e(!1!==s?{gdprApplies:t.gdprApplies,consentData:t.tcString,addtlConsent:t.addtlConsent}:null)}));const s=window.__cmp||U("__cmp");if(s)return s("getConsentData",null,((t,s)=>{e(!1!==s?{gdprApplies:t.gdprApplies||t.isUserInEu,consentData:t.consentData}:null)}));const i=O();return e(i||{gdprApplies:!1,consentData:""})})).then((e=>(e&&(N=e),N)))),Promise.race([V,new Promise((t=>{setTimeout(t,e,N)}))])},$=function(e){const t=e.advertising;if(null!=t&&t.placement){const e=t.placement.toLowerCase();if(b[e])return b[e]}return b[null!=t&&t.outstream?w:P]},z=function(){const e=(t=document.referrer)&&null!==t.match(I)?function(e){const t=e.match(D);return t&&t.length>1?`${t[1]}${t[2]}`:e}(document.referrer):"";var t;if(window.top!==window.self){try{return{url:window.top.location.href,domain:window.top.document.domain,referrer:e}}catch(e){}return{url:e,domain:S(e),referrer:""}}return{url:document.location.href,domain:document.domain,referrer:e}},Q=function(e,t){const s=function(e,t){if("start"===e||"0%"===e)return"pre";if("end"===e||"100%"===e)return"post";if("string"==typeof e&&("pre"===e||"post"===e||e.indexOf("%")>=0))return e;const s=t.seconds(e);return"number"==typeof s&&!isNaN(s)&&s}(e,t);return"pre"===s?0:"post"===s?-1:s},W=function(e,t){const s=e.getPlugin("inference"),i=t.jwpseg_client_side,n=t.jwpseg||[];let a;if(!i||!i.length||!s)return n;try{a=s.predict(i,t)}catch(e){return t.jwpseg||[]}return[...Object.keys(a).filter((e=>a[e])),...n.filter((e=>-1===i.indexOf(e)))]},G=function(e){const t=[],s=[],i=[],n=[];for(let a of e){"string"!=typeof a&&(a=String(a));const e=_(a);if(e){t.push(e);continue}const r=k(a);if(r){s.push(r);continue}const o=M(a);o?i.push(o):"JWBRSAFE"===a&&n.push(1)}return t.length||s.length||i.length||n.length?{hb_jwvb:t,hb_jwcr:s,hb_jwiab:i,hb_jwbs:n}:null},J=function(e,t){t&&"object"==typeof t&&Object.keys(t).forEach((s=>{const i=t[s];if(!i||"object"!=typeof i)return;const n=function(e,t,s){if(s&&t&&t.length)return s.sendIsIncluded?`HAS_${x[e]||"SEGMENT"}`:s.sendMax&&B.includes(e)?t.reduce(((e,t)=>Math.max(e,t)),-1/0):void 0}(s,e[s],i);void 0!==n&&(e[s]=[n])}))},X=function(e,t,s,i){const n=W(e,t);if(!n.length)return s;const a=G(n);if(!a)return s;J(a,i);const r=function(e){if(!e)return;const t=[];for(const s in e)C(e,s)&&e[s].length&&t.push(`${s}=${e[s]}`);return t.join("&")}(a),o=new URL(s),l=o.searchParams,d=l.getAll("cust_params").filter((e=>e)).join("&");return d&&d.length>0?l.set("cust_params",`${d}&${r}`):l.set("cust_params",r),o.toString()};var F=function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");return Object.prototype.hasOwnProperty.call(Object(e),t)};const K=/^((https?:)?\/\/)?(secure)?pubads\.g\.doubleclick\.net\/gampad\/ads\?[\S]*$/,Y=function(e,t,s){return e.replace(t,s)},Z=function(e,t){const s=Math.pow(10,t);return Math.round(e*s)/s},ee=function(e,t,s,i,n,a={}){var r,o,l,d,h,u,c;if(!e)return Promise.resolve(e);const m=function(e,t){const s=e.getConfig(),i=e.getPlaylistItem()===t,n={playerHeight:e.getHeight()||s.height||"",playerWidth:e.getWidth()||s.width||"",itemDuration:i&&Z(e.getDuration(),3)||"",integerDuration:i&&Z(t.duration,0)||"",item:t,jwpseg:W(e,t),placement:$(s),userAgent:navigator.userAgent},a=s.advertising?s.advertising.ampMacros:{};return Object.assign(n,a)}(t,s),y=z();let f=null;null!=s&&s.jwpseg&&(f=G(s.jwpseg));const v={viewability:(null==(r=f)||null==(o=r.hb_jwvb)?void 0:o.map((e=>encodeURIComponent(e))).join(","))||"",completion:(null==(l=f)||null==(d=l.hb_jwcr)?void 0:d.map((e=>encodeURIComponent(e))).join(","))||"",brandSafety:1===(null==(h=f)?void 0:h.hb_jwbs[0])?encodeURIComponent("Yes"):encodeURIComponent("No"),contextual:(null==(u=f)||null==(c=u.hb_jwiab)?void 0:c.map((e=>encodeURIComponent(e))).join(","))||""};-1!==e.indexOf(A)&&(a.jwpseg=m.jwpseg),e=Y(e,"__random-number__",Math.random()*Math.pow(10,18)),e=Y(e,"__timestamp__",(new Date).getTime()),e=Y(e,"__page-url__",encodeURIComponent(m.pageUrl||y.url)),e=Y(e,"__referrer__",encodeURIComponent(m.referrer||y.referrer)),e=Y(e,"__player-height__",m.playerHeight),e=Y(e,"__player-width__",m.playerWidth),e=Y(e,"__item-duration__",m.itemDuration),e=Y(e,"__integer-duration__",m.integerDuration),e=Y(e,A,m.jwpseg),e=Y(e,"__domain__",encodeURIComponent(m.domain||y.domain)),e=Y(e,"__placement__",m.placement),e=Y(e,"__device-ua__",encodeURIComponent(m.userAgent)),e=Y(e,"__jw-viewability__",v.viewability),e=Y(e,"__jw-completion__",v.completion),e=Y(e,"__jw-brand-safety__",v.brandSafety),e=Y(e,"__jw-contextual__",v.contextual),e=n.companion?Y(e,"__companion-div__",n.companion.id):Y(e,"__companion-div__","");const P=Object.keys(m).filter((e=>-1!==e.indexOf("item"))),w=P.map((e=>{const t=e.match(/item([\w]+?)(List)?$/);let s;return t&&(s=t[1].toLowerCase()),s}));let b=null;const E=/__item-([\w-]+?)(-list)?__/g,_=e;for(;null!==(b=E.exec(_));){const t=b[0],i=b[1],a=P[w.indexOf(i)];let r="";if(F(s,i)&&"string"==typeof s[i]||a){r=a?m[a]:s[i];const e=!1===n.truncateMacros?4096:1e3;r.length>e&&(r=r.substring(0,e));const t=b[2]?",":null;r=r.split(t).map(encodeURIComponent)}e=Y(e,t,r)}if(i===p){const s=t.getConfig().autostart?1:0,i=t.getMute()?1:0;e=function(e,t,s){return K.test(e)&&(e=`${e}&vpa=${t}&vpmute=${s}`),e}(e,s,i)}if(i===g&&s.title&&-1===e.indexOf("vid_t=")){const t=s.title.substring(0,100).replace(/[^\x00-\x7F]/g,"");e+=`${function(e){return-1!==e.indexOf("?")?"&":"?"}(e)}vid_t=${encodeURIComponent(t)}`}return-1!==e.indexOf("__gdpr__")||-1!==e.indexOf("__gdpr_consent__")||-1!==e.indexOf("__addtl_consent__")?H().then((({gdprApplies:t,consentData:s,addtlConsent:i})=>(e=Y(e,"__gdpr__",t?1:0),e=Y(e,"__addtl_consent__",i||""),Y(e,"__gdpr_consent__",s||"")))).catch((()=>e)):Promise.resolve(e)},te=function(){},se=function(e,t,s){let i=[];return e&&(i=e.getElementsByTagName(t),s&&i&&0===i.length&&(i=e.getElementsByTagName(`${s}:${t}`))),i},ie=function(e,t){return e?e.getAttribute(t):null},ne=function(e,t,s){e.push({message:t,code:1002,adErrorCode:70001,id:s})},ae=function(){const e=new Error("No AdBreaks in VMAP");throw e.adErrorCode=60005,e},re=function(e){if(e){const t=e.textContent||e.text;if(t)return t.trim()}return""},oe=function(e,t,s,i){let n=[];return e||t?(n=t.getElementsByTagNameNS?t.getElementsByTagNameNS(e,s):t.getElementsByTagName(`${i}:${s}`),n):n},le=function(e,t){if(e){const s=e.getElementsByTagName(t);if(s)return s[0]}return null};let de=function(e){(e.indexOf("[REGULATIONS]")>=0||e.indexOf("[GDPRCONSENT]")>=0)&&(H().catch(te),de=te)};const he=function(e,t){let s=ie(t,"event");if("progress"===s){s=`${s}_${ie(t,"offset")}`}!function(e,t,s){e[t]||(e[t]=[]),s&&(e[t].push(s),de(s))}(e,s,re(t))},ue=function(e,t){if(!e)return null;const s=e.getElementsByTagName("Ad");if(!s.length)return null;const i={_offSet:t};if(1===s.length)i._adQueue=[s[0].textContent.trim()];else{i._pod=[];for(let e=0;e<s.length;e++)i._pod.push(s[e].textContent.trim())}return i},ce=function(e,t,s){if(se(e,"VMAP",m).length)return function(e,t,s){const i=[],n=se(e,"VMAP",m);ie(n[0],"version")||ne(i,"VMAP Schema Error: version missing from VMAP tag",y);const a=se(e,"AdBreak",m);a.length||ae();const r=e.lookupNamespaceURI(m),o={};for(let e=0;e<a.length;e++){const t={},s={},n=a[e],d=ie(n,"timeOffset")||0,h=ie(n,"breakId"),u=ie(n,"breakType"),c=se(n,"AdSource",m)[0],p=ie(c,"id"),g=se(n,"AdTagURI",m)[0],y=se(n,"VASTData",m)[0]||se(n,"VASTAdData",m)[0],f=ie(g,"templateType"),v=re(g),A=oe(r,n,"Tracking",m);if(u||ne(i,"VMAP Schema Error: missing breakType on AdBreak",h),y||f||ne(i,"VMAP Schema Error: missing templateType on AdBreak",h),d||ne(i,"VMAP Schema Error: missing timeOffset on AdBreak",h),t._type=u,t._vmap={id:p,breakid:h,timeoffset:d},y)t._adXML=(l=le(y,"VAST")).ownerDocument instanceof Document?l.outerHTML||(new XMLSerializer).serializeToString(l):null;else{if("vast2"!==f&&"vast3"!==f&&"vast4"!==f)continue;t._adQueue=[v],t._waterfallIndex=0}const P=[];if(A)for(let e=0;e<A.length;e++){he(s,A[e]);const t=ie(A[e],"event");P.push(t)}(P.indexOf("breakStart")<0||P.indexOf("breakEnd")<0||P.indexOf("error")<0)&&ne(i,"Tracking events are missing breakStart, breakEnd, or error for AdBreak",h),t._trackers=s,t._type=u;const w="number"==typeof d||"string"==typeof d;w&&!o[d]?(o[d]=t,o[d]._pod=t._adQueue?[...t._adQueue]:[]):w&&o[d]&&t._adQueue&&o[d]._pod.push(...t._adQueue)}var l;return Object.keys(o).forEach((e=>{const i=o[e];switch(i._pod&&i._pod.length<=1&&delete i._pod,e){case"start":i._offSet="pre",t.setPreRoll(i);break;case"100%":case"end":i._offSet="post",t.setPostRoll(i);break;default:if(/^#/.test(e))break;/^\d\d?(?:\.\d+)?%$/.test(e)?i._offSet=e:i._offSet=s.seconds(e),t.addMidRoll(i)}})),t.preRoll||t.midRolls.length||t.postRoll||ae(),t.sort(null,!0),i}(e,t,s);if(se(e,"Playlist",m).length)return function(e,t,s){const i=se(e,"Playlist",m)[0],n=i.getElementsByTagName("Preroll")[0],a=i.getElementsByTagName("Postroll")[0],r=ue(n,"pre"),o=ue(a,"post");r&&t.setPreRoll(r),o&&t.setPostRoll(o);const l=i.getElementsByTagName("Midroll");for(let e=0;e<l.length;e++){const i=l[e],n=s.seconds(i.getAttribute("timeOffset")),a=ue(i,n);t.addMidRoll(a)}return[]}(e,t,s);throw new Error("No VMAP tag in response")},pe=function(e){e.onload=e.onreadystatechange=e.onerror=null,"abort"in e&&e.abort()},ge=function(e,t,s){if(null===e)return;let i;return Object.keys(e).forEach((t=>{const s=e[t];i=i||{},i[t]="_adQueue"===t||"_pod"===t?s.slice():s})),i?(i.requestTimeout=t,i.creativeTimeout=s,i._errors=[],i._waterfallIndex=0,i._adPodIndex=0,i):void 0},me=function(e,t){return"%"===e.toString().slice(-1)?t*parseFloat(e.slice(0,-1))/100:parseFloat(e)};class ye{constructor(e,t){this.adRules=e,this.utils=t,this.preRoll=null,this.vmap=null,this.postRoll=null,this.midRolls=[],this.playedMidRolls=[],this.duration=0,this._vmapPromise=null,this._vmapXHR=null}load(e,t,s,i){if(this._vmapPromise)return this._vmapPromise;null!==this._vmapXHR&&(pe(this._vmapXHR),this._vmapXHR=null);const n=ee(this.getVMAP(),e,t,s,i);return s===g?(this._vmapPromise=n.then((e=>{this.setPreRoll({_adQueue:[e]})})),this._vmapPromise):(this._vmapPromise=n.then((t=>new Promise(((s,n)=>{this._vmapXHR=e.utils.ajax({url:t,withCredentials:i.withCredentials,retryWithoutCredentials:!0,requireValidXML:!0,timeout:this.requestTimeout},s,((e,t,s,i)=>n(i)))})).then((i=>{this._vmapXHR=null,e.trigger("adLoadedXML",{client:s,tag:t,xml:i.responseXML});return ce(i.responseXML,this,e.utils).map((e=>Object.assign(e,{vmap:t})))})).catch((s=>{this._vmapXHR=null;const i={id:y,vmap:t};if(s.message)Object.assign(i,{message:`VMAP Schema Error: ${s.message}`,code:1002,adErrorCode:s.adErrorCode||11002});else{const t={1:{code:1007,message:"Timeout"},602:{code:1e3,message:"Invalid XML"},default:{code:1008,message:e.getConfig().localization.errors[s.key]}},n=t[s.code]||t.default;e.utils.log(n.message),Object.assign(i,{message:"Error Loading VMAP Schedule",code:n.code,adErrorCode:n.code+1e4})}throw i})))),this._vmapPromise)}canWaterfall(e){return e._adQueue&&e._waterfallIndex+1<e._adQueue.length}getPreRoll(e){return e&&"none"===this.adRules.startOnSeek?null:ge(this.preRoll,this.requestTimeout,this.creativeTimeout)}getPostRoll(e){const t=ge(this.postRoll,this.requestTimeout,this.creativeTimeout);return this.adRules.timeBetweenAdsAllowsAdPlayback(t,e)?t:null}getMidRollAtIndex(e){const t=this.midRolls[e];return ge(t,this.requestTimeout,this.creativeTimeout)}getLastMidRollIndexBetweenTime(e,t,s){if(e>t)return null;this.sort(s);let i=this.midRolls.length;for(;i--;){const n=this.midRolls[i],a=me(this.midRolls[i]._offSet,s);if(e>=a)return null;if(t>=a){const e=ge(n,this.requestTimeout,this.creativeTimeout);if(!this.adRules.timeBetweenAdsAllowsAdPlayback(e))return null;if(!this.adRules.timeBetweenAds){if(this.playedMidRolls.indexOf(i)>=0)return null;this.playedMidRolls.push(i)}return i}}return null}peek(e,t,s){if(this.midRolls.length>this.playedMidRolls.length){this.sort(s);let i=0;for(;this.midRolls[i];){const n=this.midRolls[i],a=me(n._offSet,s);if(a>=e&&-1===this.playedMidRolls.indexOf(i)){const s=q()+1e3*(a-e);return a<=t&&this.adRules.timeBetweenAdsAllowsAdPlayback(null,s)?i:null}i+=1}}const i=q()+1e3*(s-e);return this.postRoll&&t>=s&&this.adRules.timeBetweenAdsAllowsAdPlayback(null,i)?-1:null}getNextMidrollIndex(e,t,s){if(this.adRules.timeBetweenAds||this.adRules.startOnSeek)return this.getLastMidRollIndexBetweenTime(e,t,s);if(this.midRolls.length>this.playedMidRolls.length){const e=this.getClosestIndex(t,s);if(e>=0&&this.playedMidRolls.indexOf(e)<0)return this.playedMidRolls.push(e),e}return null}getMidRolls(){return this.midRolls.map((e=>ge(e,this.requestTimeout,this.creativeTimeout)))}reset(){null!==this._vmapXHR&&(pe(this._vmapXHR),this._vmapXHR=null),this.playedMidRolls=[],this.duration=0}setPreRoll(e){this.resetBreakId(e),this.preRoll=e}addMidRoll(e){this.resetBreakId(e),this.midRolls.push(e),this.duration=0}setPostRoll(e){this.resetBreakId(e),this.postRoll=e}sort(e,t){(!e||e<1)&&(e=1),(this.duration!==e||t)&&(this.duration=e,this.midRolls.sort(((t,s)=>me(t._offSet,e)-me(s._offSet,e))),function(e,t){for(let s=0;s<e.length;s++){const i=e[s];t?i._vmap.item=s+1:(i._adbreak={item:s+1,breakid:i._breakId},i._pod?i._adbreak.pod=i._pod:i._adbreak.tags=i._adQueue)}}(this.getAllAds(),t))}getAllAds(){const e=this.preRoll?[this.preRoll]:[],t=this.postRoll?[this.postRoll]:[];return e.concat(this.midRolls,t)}setVMAP(e){this.vmap=e}isVMAP(){return Boolean(this.vmap)}getVMAP(){return this.vmap}getClosestIndex(e,t){this.sort(t);let s=this.midRolls.length;for(;s--;)if(e>=me(this.midRolls[s]._offSet,t))return s;return-1}clearAds(){this.preRoll=null,this.midRolls.length=0,this.postRoll=null}resetBreakId(e){e.adBreakId=this.utils.genId(12)}resetAllBreakIds(){this.getAllAds().forEach((e=>{this.resetBreakId(e)}))}destroy(){this.reset(),this.adRules.destroy()}}const fe=function(e){return Array.isArray(e)?e.slice(0):[e]},ve=function(e,t){return 0===e?1/0:e||t};class Ae{constructor(e){this.utils=e}getSchedule(e,t){const s=new ye(t,this.utils);if(s.requestTimeout=ve(e.requestTimeout,5e3),s.creativeTimeout=ve(e.creativeTimeout,5e3),e.tag)s.setPreRoll({_offSet:"pre",_adQueue:fe(e.tag),_waterfallIndex:0});else if("string"==typeof e.vastxml)s.setPreRoll({_offSet:"pre",_adXML:e.vastxml});else{if("string"==typeof e.schedule)return s.setVMAP(e.schedule),s;if("string"==typeof e.adschedule)return s.setVMAP(e.adschedule),s;!function(e,t,s){const i=t.schedule||t.adschedule;if(!i)return;const n={};Object.keys(i).forEach((e=>{const t=i[e];t.ad&&(Object.assign(t,t.ad),delete t.ad);const a=function(e,t){if("start"===e||"0%"===e||!e&&0!==e)return"pre";if("end"===e||"100%"===e)return"post";if("pre"===e||"post"===e||`${e}`.indexOf("%")>=0)return e;const s=t.seconds(e);return"number"==typeof s&&s}(t.offset,s),r=ve(t.requestTimeout,5e3),o=ve(t.creativeTimeout,5e3);let l=n[a];if(l){if("nonlinear"===t.type)return;"nonlinear"===l._type&&(l=null)}const d=n[a]=l||{_offSet:a,_type:t.type,_breakId:e,adBreakId:s.genId(12),requestTimeout:r,creativeTimeout:o};!1===a&&s.log("Error: ad offset format not supported",a);const h=t.skipoffset;if(void 0!==h&&void 0===d.skipoffset&&(d.skipoffset=h),"string"==typeof t.adm)d.adm=t.adm;else if(t.pod){const e=d._pod||[];d._pod=e.concat(t.pod)}else if(t.tag){const e=R(t.tag,t.custParams);d._adQueue&&(d._pod=[d._adQueue[0]],delete d._adQueue),d._pod?d._pod.push(fe(e)[0]):d._adQueue=fe(e)}else"string"==typeof t.vastxml?d._adXML=t.vastxml:s.log("Error: no ad tag provided")})),Object.keys(n).forEach((s=>{const i=n[s];switch(i.skipoffset=void 0!==i.skipoffset?i.skipoffset:t.skipoffset,s){case"pre":e.setPreRoll(i);break;case"post":e.setPostRoll(i);break;default:e.addMidRoll(i)}}))}(s,e,this.utils)}return s.sort(),s}getOptParams(e,t){const s={cuetext:t.cuetext,dynamicMessage:t.admessage,loadingAd:t.loadingAd,podMessage:t.podmessage,skipoffset:e.skipoffset,skipMessage:t.skipmessage,skipText:t.skiptext,omidAccessMode:e.omidAccessMode||"full",omidSupport:e.omidSupport||"auto",allowedOmidVendors:e.allowedOmidVendors||[],vpaidcontrols:e.vpaidcontrols||!1,conditionaladoptout:e.conditionaladoptout||!1,requestFilter:e.requestFilter,trackingFilter:e.trackingFilter,withCredentials:void 0===e.withCredentials||e.withCredentials,extensions:"[object Object]"===Object.prototype.toString.call(e.extensions)?e.extensions:{}},i=e.companiondiv;return i&&(s.companion={id:i.id,height:i.height,width:i.width}),s}getAdRules(e){const t=e.rules||{},s=parseInt(t.frequency,10);return{startOn:t.startOn||1,frequency:isNaN(s)?1:s,timeBetweenAds:t.timeBetweenAds||0,startOnSeek:t.startOnSeek||null,deferAds:t.deferAds||null}}}const Pe=function(e,t=null,s={}){const i={client:e.client},{bidding:n,item:a,player:r}=e;if(e.isDestroyed()||Object.assign(i,{placement:$(r.getConfig()),viewable:r.getViewable()}),s.jwpseg&&(i.jwpseg=s.jwpseg),t){const{adBreakId:a,adPlayId:r}=e.getAdIds(t,s);if(Object.assign(i,{adBreakId:a,adPlayId:r,offset:t._offSet}),n){const e=n.getBid(r);e&&Object.assign(i,e.getEventObject())}}return i.item=a,i},we=function(e,t,s,i){return{client:i,message:e,adErrorCode:t,id:y,placement:$(s),tag:""}};class be{constructor(e,t){this.player=e,this.options=t,this.client=t.client,this.ignoreStartOnSeek=!1,this.reset(),t.timeBetweenAds&&e.on({adBreakStart:this.handleAdBreakStart,adSkipped:this.handleAdSkipped,adComplete:this.handleAdComplete,adBreakEnd:this.handleAdBreakEnd,destroyPlugin:this.destroy},this)}get timeBetweenAds(){return this.options.timeBetweenAds}get startOnSeek(){return this.ignoreStartOnSeek?null:this.options.startOnSeek}shouldDeferAds(){return this.options.deferAds&&!this.player.getConfig().activeTab}clearStartOnSeek(){this.ignoreStartOnSeek=!0}sendAdBreakIgnored(e,t){e&&this.player.trigger(f,function(e,t){let s={};return e&&(s={id:e._breakId,tag:e._adQueue&&e._adQueue.length>0?e._adQueue[0]:e._adXML,offset:e._offSet}),Object.assign(s,{timeSinceLastAd:t,type:f})}(e,t,this.client))}rulesAllowAdPlayback(e){const t=this.options,s=0===t.frequency&&1===e,i=e>=t.startOn&&(e-t.startOn)%t.frequency==0;return s||i}handleAdBreakStart(){this.adSkipped=!1,this.adComplete=!1}handleAdComplete(){this.adComplete=!0}handleAdSkipped(){this.adSkipped=!0}handleAdBreakEnd(){!this.adSkipped&&this.adComplete&&(this.recentCompletedAdTime=q())}timeBetweenAdsAllowsAdPlayback(e,t=q()){if(this.options.timeBetweenAds){const s=(t-this.recentCompletedAdTime)/1e3;if(s<this.options.timeBetweenAds)return this.sendAdBreakIgnored(e,s),!1}return!0}reset(){this.ignoreStartOnSeek=!1,this.recentCompletedAdTime=0}destroy(){this.player.off(null,null,this)}}const Ee=()=>{};class _e{constructor(e,t,s){this.player=e,this.pluginConfig=t,this.adClient=s;const i=this.configParser=new Ae(e.utils),n=this.adRules=new be(e,i.getAdRules(t),s);this.emptySchedule=new ye(n,e.utils)}getAdRules(){return this.adRules}resetDefaultSchedule(e){const t=void 0===this.pluginConfig.withCredentials||this.pluginConfig.withCredentials,s=this.defaultSchedule=this.configParser.getSchedule(this.pluginConfig,this.adRules);s.isVMAP()&&s.load(this.player,e,this.adClient,{withCredentials:t}).catch(Ee)}getSchedule(e,t){return t>0&&!this.adRules.rulesAllowAdPlayback(t)?this.emptySchedule:null!=e&&e.adschedule?this.configParser.getSchedule(e,this.adRules):(this.resetDefaultSchedule(e),this.defaultSchedule)}getOptParams(e,t){return this.configParser.getOptParams(e,t)}reset(){this.adRules.reset()}destroy(){this.emptySchedule&&this.emptySchedule.destroy(),this.defaultSchedule&&this.defaultSchedule.destroy()}}var ke=function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");return Object.prototype.hasOwnProperty.call(Object(e),t)};const Me={adPosition:"",autoplayadsmuted:!1,companiondiv:null,companionResourceType:"",customUi:null,debug:!1,omidSupport:"disabled",omidAccessModeRules:{},enablePreloading:!1,loadVideoTimeout:15e3,locale:"",maxRedirects:-1,ppid:"",preloadAds:!1,requestTimeout:1e4,truncateMacros:!0,vastLoadTimeout:1e4,vpaidcontrols:!1,vpaidmode:"insecure"},Ce=e=>{if("true"===e)return!0;if("false"===e)return!1;const t=parseFloat(e);return isNaN(t)?e:t};class Ie{constructor(e,t){this.config=e,this.utils=t,this.bidsResponse={};for(const t in Me)if(ke(Me,t)){let s=e[t];const i=Me[t],n=typeof i;if(void 0!==s){if("boolean"!==n&&"number"!==n||(s=Ce(s)),typeof s!==n)throw new Error(`invalid parameter: ${t} should be a ${n}`);this[t]=s}else this[t]=i}}setLocalizationOptions({admessage:e,cuetext:t,podmessage:s,loadingAd:i,skipmessage:n,skiptext:a}){this.admessage=e,this.cuetext=t,this.loadingAd=i,this.podmessage=s,this.skipmessage=n,this.skiptext=a}}class Re{constructor(e,t,s){s.addClass(e,"jw-plugin-googima");const i=document.createElement("div");i.id=`${t}_ad`,i.className="jw-ads-view",this.visible=!1,this.utils=s,this.div=e,this.adDiv=i,e.appendChild(i)}resizeNonLinear(e){this.resize(!1,e)}resizeLinear(){this.resize(!0)}resize(e,t){const s=this.utils;s.toggleClass(this.div,"jw-ad-non-linear",!e),s.toggleClass(this.div,"jw-ad-linear",e),s.style(this.div,{height:t?`${t}px`:""})}getAdDiv(){return this.adDiv}adSetup(){this.visible=!0,this.utils.addClass(this.div,"jw-ad-instream"),this.resize(!0)}adTakeDown(){this.visible=!1,this.utils.removeClass(this.div,"jw-ad-instream"),this.resize(!0)}}let Se=null;function je(e){if(Se)return Se;if(window.google&&google.ima&&google.ima.AdDisplayContainer)return Se=Promise.resolve(),Se;const t=["//","imasdk.googleapis.com/js/sdkloader/ima3.js"];"file:"===document.location.protocol&&t.unshift("https:");const s=new(0,e.scriptloader)(t.join(""));return Se=s.load(),Se}class Le{constructor(e,t,s){e.extend(this,t),this.vol=0,this.imaProxy=null,this.view=s}setProxy(e){this.imaProxy=e,"boolean"==typeof this.muted&&this.mute(this.muted)}attachMedia(){}detachMedia(){}mute(e){this.muted=e,this.imaProxy&&(e?this.imaProxy.setVolume(0):this.vol>=0&&this.imaProxy.setVolume(this.vol)),this.muteAllAdContainerVideo(e)}muteAllAdContainerVideo(e){const t=this.view.getAdDiv().getElementsByTagName("video");for(let s=0;s<t.length;s++)t[s].muted=e}volume(e){this.vol=e/100,this.imaProxy&&this.imaProxy.setVolume(this.vol)}}const Te=function(){};class xe{constructor(e,t,s,i,n){Object.assign(this,e.Events),this.client="shared",this.player=e,this.item=s,this.config=i,this.casting=n;const a=e.utils,r=new Ae(a);this.adRules=new be(e,r.getAdRules(i)),"string"==typeof t?(this.schedule=new ye(this.adRules,a),this.schedule.setPreRoll({tag:t})):(this.schedule=t,t.resetAllBreakIds()),this.vmapPromise=null,this.lastTimeEvent=null,this.prerollPromise=null,this.midrollPromise={},this.postrollPromise=null,this.next=null,this.nextPlaylistItemPromise=null,this.relatedNextUp=null,this.bidding=e.getPlugin("bidding"),this.bids=[],this.bidsPromises=[],this.bidsPromise=null,this._events=[]}attachListeners(){this.player.on({all:this.onAll,beforePlay:this.checkPreroll,relatedReady:this.relatedReady,cast:this.onCast,destroyBidding:this.destroyBids},this)}onAll(e,t){"time"===e?this.checkMidrolls(t):"beforeComplete"===e&&this.checkPostrolls(t),"complete"===e&&(this.player.videoHasCompleted=!0)}relatedReady(){if(this.config.preloadAds){const e=this.player.getPlugin("related");e&&e.on("nextUp",(e=>{e&&"discovery"===e.mode&&(this.relatedNextUp=e)}))}}onCast(e){this.casting=Boolean(e.active)}init(e,t){if(this.config.clearAdsOnComplete&&this.player.videoHasCompleted&&this.schedule.clearAds(),e=e||null,this.schedule.isVMAP()&&(t.requestTimeout=this.schedule.requestTimeout,t.creativeTimeout=this.schedule.creativeTimeout,this.vmapPromise=this.schedule.load(this.player,this.item,this.client,t)),this.bidsPromise=this.vmapPromise||Promise.resolve(),this.bidsPromise=null!==e?this.bidsPromise.then((()=>{if(this.isDestroyed())return;if(this.bidding)return this.createBidsPromise(e,t);const s=function(e,t,s){const i=Pe(e,t,s);return Object.assign(i,{message:"Ad Error: bidding plugin unavailable",code:900,adErrorCode:60008}),i}(this,null,t);this.player.trigger(v,s)})).catch(Te):this.bidsPromise.catch(Te),this.config.preloadAds)if(1===t.playlistItemEventCount){const e=this.player.getConfig().autostart;!1===e||"viewable"===e&&0===this.player.getViewable()?this.loadPreroll(t).catch((e=>this.isDestroyed()?null:this.enqueueAdEvent(v,e,{preload:!0}))):this.player.once("autostartNotAllowed",(()=>{this.loadPreroll(t).catch((e=>this.isDestroyed()?null:this.enqueueAdEvent(v,e,{preload:!0})))}))}else t.preloadPreroll&&this.loadPreroll(t).catch((e=>this.isDestroyed()?null:this.enqueueAdEvent(v,e,{preload:!0})));return this.bidsPromise}createBidsPromise(e,t){const s=this.player;let i=parseInt(e.bidOnBreaks,10);return i=i>0?i:1/0,this.bids=this.schedule.getAllAds().slice(0,i).map((i=>{const{adPlayId:n}=this.getAdIds(i),a=s.getConfig(),{skipoffset:r}=this.config,o=null!=r&&r>=0,l=W(s,this.item),d={id:n,offset:e.offset,jwpseg:l,placement:$(a),tag:i._adQueue?i._adQueue[0]:i._currentTag,adClient:this.client};this.client===p&&(d.skipoffset=o?r:-1);const h=this.bidding.createNewBid(d,{getURLParts:z});this.player.trigger("adBidRequest",Pe(this,i,Object.assign({jwpseg:l},t))),h.init();const u=h.start().then((({result:e})=>{if(this.isDestroyed())return;let s=Promise.resolve();var n;e&&!e.error&&(i.jwpseg=l,e.adm?(i._adXML=e.adm,null!=i&&null!=(n=i._adQueue)&&n.length&&i._adQueue.unshift(e.adm)):e.tag&&(s=ee(e.tag,this.player,this.item,this.client,{},i).then((e=>{this.client===p?(i._adQueue=i._adQueue||[],i._adQueue.unshift(e)):i._adQueue=[e]}))));return this.player.trigger("adBidResponse",Pe(this,i,t)),s}));return this.bidsPromises.push(u),h})),Promise.all(this.bidsPromises)}checkPreroll(e){if(this.bidTimeoutStarted||(this.bidTimeoutStarted=!0,this.bids.forEach((e=>e.timeout()))),this.casting||this.preRollPlayed||this.adRules.shouldDeferAds())return;this.preRollPlayed=!0;const t=(null==e?void 0:e.startTime)||this.player.getPosition();this.lastTimeEvent=t||this.lastTimeEvent;const s=this.schedule.getPreRoll(t);if(!s&&!this.vmapPromise)return;(null!==this.vmapPromise||s&&"nonlinear"!==s._type)&&this.startBlocking(),this.bidsPromise.then((()=>{if(this.isDestroyed())return;const e=this.schedule.getPreRoll(t);e&&"nonlinear"!==e._type&&this.triggerAdBreakEvents(e,"pre")})),t?"none"===this.adRules.startOnSeek&&(this.prerollPromise=null):this.adRules.clearStartOnSeek();const i=null!=e&&e.playReason?e.playReason:"external";this.playPreroll({adBlock:this.adBlockErrorDetected,startTime:t,reason:i})}checkMidrolls(e){if(this.casting||0===e.duration||this.adRules.shouldDeferAds())return;const t=this.schedule.getNextMidrollIndex(this.lastTimeEvent,e.position,e.duration);if(this.lastTimeEvent=e.position,null!==t){const e=this.schedule.getMidRollAtIndex(t);"nonlinear"!==e._type&&(this.startBlocking(),this.triggerAdBreakEvents(e,"mid")),this.playMidrollAtIndex(t,{adBlock:this.adBlockErrorDetected})}else if(!this.preRollPlayed&&this.schedule.getClosestIndex(e.position,e.duration)<0)this.checkPreroll(e);else if(this.config.preloadAds){const t=e.position+5,s=this.schedule.peek(e.position,t,e.duration);if(null!==s&&s>=0)this.loadMidrollAtIndex(s,{adBlock:this.adBlockErrorDetected,preload:!0}).catch(Te);else if(-1===s){const t=q()+1e3*(e.duration-e.position);this.loadPostroll({adBlock:this.adBlockErrorDetected,preload:!0,startTime:t}).catch(Te)}else if(null===this.next&&null===this.nextPlaylistItemPromise&&t>e.duration){const e=this.player.getPlaylistIndex()+1,t=this.player.getPlaylistItem(e);if(this.nextPlaylistRelated=Boolean(this.relatedNextUp),t||this.relatedNextUp){const t=this.relatedNextUp?-1:e;this.nextPlaylistItemPromise=Promise.resolve(this.player.getPlaylistItemPromise(t)).then((()=>{this.isDestroyed()||(this.trigger("preloadNext",{item:this.player.getPlaylistItem(e)||this.relatedNextUp,index:t}),this.relatedNextUp=null,this.nextPlaylistItemPromise=null)})).catch(Te)}}}}checkPostrolls(e){if(this.casting||this.adRules.shouldDeferAds()||this.isDestroyed())return;const t=this.schedule.getPostRoll();t&&("nonlinear"!==t._type&&(this.startBlocking(),this.triggerAdBreakEvents(t,"post")),this.playPostroll(e))}getAdIds(e,{tagIndex:t,podIndex:s}={}){let i=e.adRequestIds&&void 0!==t?e.adRequestIds[t]:null;if(!i){const t=`p${s||e._adPodIndex||0}w${e._waterfallIndex||0}`;"p0w0"===t?i=e.adBreakId:(e.adPlayIds=e.adPlayIds||{},i=e.adPlayIds[t]=e.adPlayIds[t]||this.player.utils.genId(12))}return{adBreakId:e.adBreakId,adPlayId:i}}loadPreroll(e={}){return this.prerollPromise||(this.prerollPromise=this.bidsPromise.then((()=>{if(this.isDestroyed())return;const t=this.schedule.getPreRoll(e.startTime);return t?(t._position="pre",t._preload=!0,this.loadAd(t,e)):void 0}))),this.prerollPromise}loadMidrollAtIndex(e,t){return this.midrollPromise[e]||(this.midrollPromise[e]=this.bidsPromise.then((()=>{if(this.isDestroyed())return;const s=this.schedule.getMidRollAtIndex(e);return s?(s._position="mid",s._preload=!0,this.loadAd(s,t)):void 0}))),this.midrollPromise[e]}loadPostroll(e={}){return this.postrollPromise||(this.postrollPromise=this.bidsPromise.then((()=>{if(this.isDestroyed())return;const t=this.schedule.getPostRoll(e.startTime);return t?(t._position="post",t._preload=!0,this.loadAd(t,e)):void 0}))),this.postrollPromise}playPreroll(e){this.prerollPromise?this.playPreloadedPromise(this.prerollPromise,e):this.bidsPromise.then((()=>{if(this.isDestroyed())return;const t=this.schedule.getPreRoll(e.startTime);t?(t._position="pre",this.startAdBreak(t,e)):this.stopBlocking()}))}playMidrollAtIndex(e){this.midrollPromise[e]?this.playPreloadedPromise(this.midrollPromise[e]):this.bidsPromise.then((()=>{const t=this.schedule.getMidRollAtIndex(e);t&&(t._position="mid",this.startAdBreak(t))}))}playPostroll(e){this.postrollPromise?this.playPreloadedPromise(this.postrollPromise):this.bidsPromise.then((()=>{const t=this.schedule.getPostRoll();t&&(t._position="post",this.startAdBreak(t,e))}))}isDestroyed(){return null===this.player}destroy(){this.destroyBids(),this.player.off(null,null,this),this.player=null}destroyBids(){this.bids.forEach((e=>e.stop())),this.bidsPromises=[],this.bids=[]}enqueueAdEvent(e,t,s){this._events.push({type:e,event:t}),s.preload||this.dequeueAdEvents()}dequeueAdEvents(){}triggerAdBreakEvents(){}startBlocking(){}stopBlocking(){}loadAd(){}playPreloadedPromise(){}startAdBreak(){}}const Be=(e,t,...s)=>{if(null!=e&&e[t]&&"function"==typeof e[t])try{return e[t](...s)}catch(e){return null}return null},De=(t,s,i,n={})=>{s=s||null;const a={client:e};if(!t)return a;const{bidding:r,config:o,player:l}=t;Object.assign(a,{placement:$(l.getConfig()),viewable:l.getViewable()}),n.jwpseg&&(a.jwpseg=n.jwpseg),o.preloadAds&&(a.preloadAds=n.preload||(null==i?void 0:i._preload)||!1);const d=Be(s,"getAdPodInfo");if(d){const e=Be(d,"getTotalAds");if(e>1){const t=Be(d,"getAdPosition");Object.assign(a,{sequence:t,podcount:e}),n.podIndex="number"==typeof t?t-1:0}if(void 0===a.adposition){const e=Be(d,"getTimeOffset");a.adposition=0===e?"pre":-1===e?"post":"mid"}}if(i){const{adBreakId:e,adPlayId:s}=t.getAdIds(i,n);if(Object.assign(a,{tag:i._adQueue&&i._adQueue.length>0?i._adQueue[0]:i._adXML||i.adm,adBreakId:e,adPlayId:s,id:e,adposition:i._position}),i.jwpseg&&(a.jwpseg=i.jwpseg),r){const e=r.getBid(s);e&&Object.assign(a,e.getEventObject())}}const h=t.adsLoaderManager||n.loader;if(s){if(h){const e=a.mediationLayerAdServer;if("dfp"===e||"jwpdfp"===e){-1!==(Be(s,"getWrapperAdSystem")||[]).concat(Be(s,"getAdSystem")||[]).indexOf("SpotXJW")&&a.bidders.forEach((e=>{e.winner="SpotX"===e.name}))}const t=h.userRequestContext;Object.assign(a,{tag:a.tag||h.getTag(s),ima:{ad:s,userRequestContext:t}})}Object.assign(a,{adtitle:s.getTitle(),adsystem:s.getAdSystem(),creativetype:s.getContentType(),duration:s.getDuration(),linear:s.isLinear()?"linear":"nonlinear",description:s.getDescription(),creativeAdId:s.getCreativeAdId(),adId:s.getAdId(),universalAdId:s.getUniversalAdIds().map((e=>({universalAdIdRegistry:e.g,universalAdIdValue:e.h}))),advertiser:s.getAdvertiserName(),dealId:s.getDealId()});const e=s.getMediaUrl();e&&(a.mediaFile={file:e})}return void 0!==n.offset&&Object.assign(a,{adposition:a.adposition||n.offset,offset:n.offset}),a},Oe=(e,t,s,i,n)=>{const a=De(e,s,i,n),r=t.getVastErrorCode?t.getVastErrorCode():t.code;let o=t.getErrorCode?t.getErrorCode():t.adErrorCode;return o=o<1e4?o+2e4:o||60900,Object.assign(a,{message:`Ad Error: ${t.getMessage?t.getMessage():t.message}`,code:r>=100&&r<=1008?r:900,adErrorCode:o}),e&&(20402===o?a.timeout=e.options.loadVideoTimeout:21009===o?a.timeout=e.options.vastLoadTimeout:60004===o&&(a.timeout=e.options.requestTimeout)),void 0!==t.placement&&(a.placement=t.placement),void 0!==t.id&&(a.id=t.id),t.getInnerError&&(a.sourceError=t.getInnerError()),void 0!==t.tag&&(a.tag=t.tag),a},qe=e=>e.isBeforePlay()||0===e.getPosition()?"pre":e.isBeforeComplete()||e.getPosition()===e.getDuration()?"post":"mid",Ue=()=>null;class Ve{constructor(e,t){const{player:s,options:i,instreamProvider:n,view:a,adsLoaderManager:r,video:o,item:l,client:d}=e;if(s.utils.extend(this,s.Events),this.playlistItemManager=e,this.player=s,this.options=i,this.instreamProvider=n,this.view=a,this.adsLoaderManager=r,this.video=o,this.item=l,this.client=d,this.reason=t,this.env=s.getEnvironment(),this.utils=s.utils,this._qoe=new s.utils.Timer,i.customUi){const e=i.customUi;this.mainContainer=s.getContainer(),this.customUiDiv=document.getElementById(e.customUiDivId),this.adClickButton=document.getElementById(e.adClickButtonId),this.customCountDownDiv=document.getElementById(e.customCountDownId),this.customSkipButton=document.getElementById(e.customSkipButtonId),this.timeTillSkip=Number.POSITIVE_INFINITY}this.initAdsManagerPromise=null,this.blockingInstreamPlayer=null,this.currentAd=null,this.progressIntervalId=-1,this.viewablePlayedTime=0,this.lastPosition=null,this.adViewableImpressionHandler=Ue,this.paused=!1,this.playbackProxy={currentTime:this.player.getPosition(),duration:this.player.getDuration()},s.on("time",this.time,this),this.debugConsoleLog=Ue,i.debug&&(this.debugConsoleLog=function(...e){console.log(e)})}time(e){this.playbackProxy.currentTime=e.position,e.duration>=e.position?this.playbackProxy.duration=e.duration:this.playbackProxy.duration=1/0}init(e,t,s){this.requestType=e,this.requestOptions=t,this.scheduledAd=s,this.offset=s._offset;const i=this.adsLoaderManager;return this.initAdsManagerPromise=this.initAdsManagerPromise||je().then((()=>this.destroyed()?null:(this.debugConsoleLog("[JW DEBUG] Open adsLoaderManager"),i.open(e,t,this.video)))).then((e=>{if(this.destroyed())return null;const s=i.getAdsManager(e,this.playbackProxy,this.options);if(this.instreamProvider.setProxy(s),i.bindEvents({AD_ERROR:this.adError.bind(this),LOADED:this.adLoaded.bind(this),CONTENT_PAUSE_REQUESTED:this.pauseRequested.bind(this),CONTENT_RESUME_REQUESTED:this.resumeRequested.bind(this),LOG:this.adLog.bind(this),STARTED:this.adStarted.bind(this),IMPRESSION:this.adImpression.bind(this),LINEAR_CHANGED:this.resize.bind(this),CLICK:this.adClick.bind(this),PAUSED:this.adPaused.bind(this),RESUMED:this.adResumed.bind(this),SKIPPED:this.adSkipped.bind(this),USER_CLOSE:this.adUserClose.bind(this),ALL_ADS_COMPLETED:this.allAdsCompleted.bind(this)},this),t.preloadAds)clearTimeout(this.timeoutAdStart);else{const{width:e,height:t}=this.player.getSafeRegion(!1),s=this.getViewMode();this.debugConsoleLog("[JW DEBUG] adsManager init with",e,t,s),i.init(e,t,s)}const n=s.getCuePoints();if(n.length){const e=n.filter((e=>e>0)).map((e=>({begin:e,text:this.options.cuetext,cueType:"ads"})));this.player.addCues(e)}return s})).catch((e=>{if(clearTimeout(this.timeoutAdStart),this.asyncError&&!s._preload&&this.asyncError(e),null!=e&&e.getError){const t=e.getError();throw this.getAdErrorEventObject(t,e)}throw e})),this.initAdsManagerPromise}getViewMode(){const e=google.ima.ViewMode;return this.player.getFullscreen()?e.FULLSCREEN:e.NORMAL}beforeComplete(){const e=this.adsLoaderManager.adsManager;e&&e.getCuePoints().indexOf(-1)>-1&&this.playlistItemManager.startBlocking(),this.adsLoaderManager.unbindEvents(["CONTENT_RESUME_REQUESTED"]),this.debugConsoleLog("[JW DEBUG] Call contentComplete on IMA SDK"),this.adsLoaderManager.contentComplete()}requestAds(){var e,t;if(this.destroyed())return;this.debugConsoleLog("[JW DEBUG] Request ads to IMA SDK");let s=Promise.resolve();if(null!=this&&null!=(e=this.scheduledAd)&&null!=(t=e._adQueue)&&t.length){const e=this.scheduledAd._adQueue.map(((e,t)=>ee(e,this.player,this.item,this.client,this.options,this.scheduledAd).then((e=>{e=X(this.player,this.item,e,this.options.config.targeting),this.scheduledAd._adQueue[t]=e}))));s=Promise.all(e)}return s.then((()=>{this.startRequestTimeout(),this.trigger("adRequest",De(this.playlistItemManager,null,this.scheduledAd)),this.adsLoaderManager.requestAds(this.requestType,this.requestOptions,this.options,this.scheduledAd)}))}muteInstreamProvider(){const e=this.video.muted||this.player.getMute();this.debugConsoleLog("[JW DEBUG] Setting mute on instreamProvider",e),this.instreamProvider.mute(e)}pauseRequested(e){const t=this.playlistItemManager.schedule.isVMAP();t&&this.playlistItemManager.startBlocking();const s=null==e?void 0:e.getAd();if(t){const e=Be(s,"getAdPodInfo"),t=Be(e,"getTimeOffset");if(t){const e=-1===t?"post":"mid";this.scheduledAd._position=e,this.playlistItemManager.triggerAdBreakEvents(this.scheduledAd,e)}}const i=De(this.playlistItemManager,s,this.scheduledAd);this.trigger(l,i)}resumeRequested(){var e;this.debugConsoleLog("[JW DEBUG] ResumeRequest from IMA SDK"),null!=this&&null!=(e=this.currentAd)&&e.isLinear()&&this.finishAd(),this.blockingInstreamPlayer&&this.view.adTakeDown(),this.trigger("stopBlocking"),this.blockingInstreamPlayer=null}finishAd(){this.currentAd&&(this.hideCustomUi(),clearInterval(this.progressIntervalId),this.viewablePlayedTime=0,this.currentAd=null)}discardAdBreak(e){!e&&this.adsLoaderManager&&(e=this.adsLoaderManager.adsManager),!this.destroyed()&&e&&(0===e.getCuePoints().length?this.destroy():(e.discardAdBreak(),e.stop()))}asyncDiscardAdBreak(){this.initAdsManagerPromise&&this.initAdsManagerPromise.then((e=>this.discardAdBreak(e))).catch(Ue)}pause({reason:e}){if(this.destroyed())return;const t=this.adsLoaderManager.adsManager;t&&(this.viewablePlayedTime=0,this.debugConsoleLog("[JW DEBUG] JW Player pause ad"),this.reason=e||u,t.pause())}resume({reason:e}){if(this.destroyed())return;const t=this.adsLoaderManager.adsManager;t&&(this.debugConsoleLog("[JW DEBUG] JW Player resume ad"),this.reason=e||u,t.resume())}startRequestTimeout(){clearTimeout(this.timeoutAdStart),this.timeoutAdStart=setTimeout((()=>{this.debugConsoleLog("[JW DEBUG] Ad request timeout"),this.destroyed()||(this.asyncError=null,this.handleAdError({message:`Ad Request timeout after ${this.options.requestTimeout} milliseconds`,getErrorCode:()=>60004}),this.asyncDiscardAdBreak())}),this.options.requestTimeout)}startAdsLoader(e){if(this.destroyed()||!this.initAdsManagerPromise)return Promise.reject();this.player.off("beforePlay",null,this),e&&(this.blockingInstreamPlayer=e,e.setText(this.options.loadingAd)),this.muteInstreamProvider(),this._qoe.tick("adBeforePlay"),this.startRequestTimeout(),this.initAdsManagerPromise.then((()=>{if(this.destroyed())return;const e=this.adsLoaderManager;if(!e.initialized){const{width:t,height:s}=this.player.getSafeRegion(!1),i=this.getViewMode();this.debugConsoleLog("[JW DEBUG] adsManager init with",t,s,i),e.init(t,s,i)}this.debugConsoleLog("[JW DEBUG] Start adsManager"),e.start()})).catch(Ue)}resize(){const e=this.currentAd,t=this.adsLoaderManager.adsManager;if(!t)return;const s=e&&!e.isLinear(),i=this.player.getSafeRegion(s);if(s){let s=e.getHeight();s=this.player.getFullscreen()?i.height/2:Math.max(100,s+10),this.debugConsoleLog("[JW DEBUG] Resize adsManager",i.width,s,this.getViewMode()),t.resize(i.width,s,this.getViewMode()),this.view.resizeNonLinear(s)}else this.debugConsoleLog("[JW DEBUG] Resize adsManager",i.width,i.height,this.getViewMode()),t.resize(i.width,i.height,this.getViewMode()),this.view.resizeLinear()}setState(e,t,s){if(!e.isLinear())return;const i=De(this.playlistItemManager,e,this.scheduledAd);if(i.newstate=t,s&&(i.oldstate=s),null!==this.reason){i[t===r?"playReason":"pauseReason"]=this.reason,this.reason=null}this.instreamProvider.trigger("state",i)}customMainClickHandler(){this.adsLoaderManager.adsManager.resume()}customSkipHandler(e){if(e.stopPropagation(),this.timeTillSkip<=0){this.adsLoaderManager.adsManager.skip()}}customClickHandler(e){e.stopPropagation(),this.adsLoaderManager.adsManager.clicked()}addCustomEventHandlers(){this.mainClick=this.customMainClickHandler.bind(this),this.customSkip=this.customSkipHandler.bind(this),this.customClick=this.customClickHandler.bind(this),this.mainContainer.addEventListener("click",this.mainClick),this.adClickButton&&this.adClickButton.addEventListener("click",this.customClick),this.customSkipButton&&this.customSkipButton.addEventListener("click",this.customSkip)}removeCustomEventHandlers(){this.mainContainer.removeEventListener("click",this.mainClick),this.adClickButton&&this.adClickButton.removeEventListener("click",this.customClick),this.customSkipButton&&this.customSkipButton.removeEventListener("click",this.customSkip)}showCustomUi(){this.customUiDiv&&(this.customUiDiv.style.display="block",this.addCustomEventHandlers())}hideCustomUi(){this.customUiDiv&&(this.customUiDiv.style.display="none",this.removeCustomEventHandlers())}adLoaded(e){clearTimeout(this.timeoutAdStart);const t=e.getAd();if(this.playlistItemManager.schedule.isVMAP()){const e=Be(t,"getAdPodInfo"),s=Be(e,"getTimeOffset");s&&(this.scheduledAd._position=-1===s?"post":"mid")}const s=De(this.playlistItemManager,t,this.scheduledAd);this.trigger("adLoaded",s)}adStarted(e){this.player.getPip()&&this.player.requestPip(this.view.getAdDiv().querySelector("video"));const t=e.getAd();this.currentAd=t,this.paused=!1,t.isUiDisabled()&&this.showCustomUi();const s=De(this.playlistItemManager,t,this.scheduledAd);this.trigger(d,s)}adImpression(e){this.view.adSetup();const t=e.getAd(),s=t.isLinear(),i=s&&(t.getContentType().indexOf("image")>=0||-1===t.getDuration()),o=this.isVpaidAd(t),d=s&&o&&this.options.vpaidcontrols;this.currentAd=t,this.blockingInstreamPlayer&&this.blockingInstreamPlayer.setSkipOffset(t.getSkipTimeOffset()),this.adsLoaderManager.bindEvents({COMPLETE:this.adComplete.bind(this)}),o&&this.env.OS.mobile&&this.options.autoplayadsmuted&&this.adsLoaderManager.bindEvents({VOLUME_CHANGED:()=>{this.adsLoaderManager.unbindEvents(["VOLUME_CHANGED"]),this.player.setMute(0===this.adsLoaderManager.adsManager.getVolume())}}),s||this.trigger("stopBlocking",{isNonlinear:!0}),this.utils.toggleClass(this.player.getContainer(),n,s&&(i||o)),this.utils.toggleClass(this.player.getContainer(),a,d),this.resize(),this.muteInstreamProvider(),clearTimeout(this.timeoutAdStart);const h=this.adsLoaderManager.adsManager;this.progressInterval(t,h);const u=De(this.playlistItemManager,t,this.scheduledAd),c=void 0===u.podcount||1===u.sequence;"pre"===u.adposition&&c&&(this._qoe.tick("adImpression"),u.timeLoading=this._qoe.between("adBeforePlay","adImpression")),s&&!c&&this.trigger(l,u),this.trigger("adImpression",u,t),this.setupViewableListener(),this.setState(t,r,"buffering")}progressInterval(e,t){if(clearInterval(this.progressIntervalId),!t)return;const s=e.getAdId(),i=e.isSkippable()&&this.customSkipButton;let n=-1;const a=this.options.admessage||"",r=this.options.podmessage||"",o=this.options.skipmessage||"",l=this.options.skiptext||"",d=new RegExp("__AD_POD_CURRENT__","g"),h=new RegExp("__AD_POD_LENGTH__","g");this.progressIntervalId=setInterval((()=>{if(!this.currentAd||this.currentAd.getAdId()!==s)return void clearInterval(this.progressIntervalId);const u=t.getRemainingTime();if(isNaN(u)||u<=0)return;if(n===u)return;n=u;const c=this.currentAd.getDuration(),p=c-u,g=Math.round(c-p);if(i){const t=this.timeTillSkip=Math.ceil(e.getSkipTimeOffset()-p);t>0?(this.customSkipButton.innerText=o.replace(/(\b)xx(s?\b)/g,`$1${t}$2`),this.customSkipButton.style.cursor="default"):(this.customSkipButton.innerText=l,this.customSkipButton.style.cursor="pointer")}if(this.blockingInstreamPlayer){let e=a.replace(/(\b)xx(s?\b)/g,`$1${g}$2`);const t=Be(this.currentAd,"getAdPodInfo");if(t){const s=Be(t,"getTotalAds");if(s>1){const i=Be(t,"getAdPosition");e=`${r.replace(d,i).replace(h,s)}  ${e}`}}this.blockingInstreamPlayer.setText(e),this.customCountDownDiv&&(this.customCountDownDiv.innerText=e),this.instreamProvider.trigger("time",{duration:c,position:p})}if(c>0){const t=De(this.playlistItemManager,e,this.scheduledAd);t.position=p,t.duration=c,this.adViewableImpressionHandler(t),this.trigger("adTime",t)}}),250)}setupViewableListener(){this.player.off(h,this.viewableHandler,this),this.player.on(h,this.viewableHandler,this),this.viewableHandler({viewable:this.player.getViewable()})}adViewableHandler(e){const{position:t}=e;null===this.lastPosition&&(this.lastPosition=t);let s=t-this.lastPosition;if(this.lastPosition=t,s=Math.min(Math.max(0,s),4),this.viewablePlayedTime+=s,this.viewablePlayedTime>=2){this.player.off(h,this.viewableHandler,this),this.adViewableImpressionHandler=Ue;const e=De(this.playlistItemManager,this.currentAd,this.scheduledAd);this.trigger("adViewableImpression",e)}}viewableHandler(e){e.viewable?(this.viewablePlayedTime=0,this.lastPosition=null,this.adViewableImpressionHandler=this.adViewableHandler):this.adViewableImpressionHandler=Ue}adComplete(e){const t=e.getAd();this.finishAd();const s=De(this.playlistItemManager,t,this.scheduledAd);this.trigger("adComplete",s),this.adsLoaderManager.unbindEvents(["VOLUME_CHANGED"])}adClick(e){const t=this.adsLoaderManager.adsManager,s=e.getAd();this.reason="clickthrough",this.isVpaidAd(s)||(this.debugConsoleLog("[JW DEBUG] Ad paused due to ad click"),t.pause());const i=De(this.playlistItemManager,s,this.scheduledAd);this.trigger("adClick",i)}adPaused(e){if(!this.paused){this.paused=!0;const t=e.getAd();null===this.reason&&this.isVpaidAd(t)&&(this.reason=c),this.setState(t,"paused")}}adResumed(e){if(this.paused){this.paused=!1;const t=e.getAd();null===this.reason&&this.isVpaidAd(t)&&(this.reason=c),this.setState(t,r)}}adSkipped(e){const t=e.getAd();this.debugConsoleLog("[JW DEBUG] AdSkipped"),this.adsLoaderManager.unbindEvents(["COMPLETE","VOLUME_CHANGED"]),this.finishAd();const s=De(this.playlistItemManager,t,this.scheduledAd);this.trigger("adSkipped",s)}adUserClose(e){var t;this.debugConsoleLog("[JW DEBUG] AdUserClose"),null!=this&&null!=(t=this.currentAd)&&t.isLinear()&&-1===this.currentAd.getDuration()?this.adSkipped(e):(this.adsLoaderManager.unbindEvents(["COMPLETE","VOLUME_CHANGED"]),this.finishAd())}allAdsCompleted(){this.resumeRequested(),this.stopAdsManager(),this.trigger("allAdsComplete",{})}stopAdsManager(){this.initAdsManagerPromise.then((e=>{this.destroyed()||(this.debugConsoleLog("[JW DEBUG] Stop IMA SDK adsManager"),e.stop(),e.destroy(),this.initAdsManagerPromise=null)})).catch(Ue)}adLog(e){this.debugConsoleLog("[JW DEBUG]",e.type,e);const t=Be(e,"getAdData"),s=null==t?void 0:t.adError;if(s&&402===s.getVastErrorCode())this.handleAdError(s,e);else if(s){const t=Be(e,"getAd");this.trigger(o,Oe(this.playlistItemManager,s,t,this.scheduledAd,{jwpseg:this.adsLoaderManager.getJwpSeg(t)}))}}adError(e){const t=e.getError();this.handleAdError(t,e)}asyncError(e){var t;if(!this.destroyed())if(clearTimeout(this.timeoutAdStart),this.timeoutAdStart=setTimeout((()=>this.destroy()),0),null!=e&&e.getError){const t=e.getError();this.handleAdError(t,e,!0)}else null!=e&&null!=(t=e.target)&&t.src?console.error(`Failed to load ${e.target.src}`):console.error(e)}getAdErrorEventObject(e,t){const s=Be(t,"getUserRequestContext"),i=s?s.offset:void 0;return Oe(this.playlistItemManager,e,null,this.scheduledAd,{offset:i})}handleAdError(e,t,s){this.options.debug&&console.error(e);const i=this.getAdErrorEventObject(e,t);this.player&&0===this.player.getPosition()&&(this._qoe.tick("adError"),i.timeLoading=this._qoe.between("adBeforePlay","adError")),this.trigger(o,i),this.destroyed()||(900===e.getErrorCode()||s?(clearTimeout(this.timeoutAdStart),this.timeoutAdStart=setTimeout((()=>this.destroy()),0)):this.destroy())}isVpaidAd(e){const t=e.getContentType();return"application/javascript"===t||"application/x-shockwave-flash"===t}destroy(){this.debugConsoleLog("[JW DEBUG] JW Player destroy AdsPlayer"),this.trigger("stopBlocking",{isDestroyed:!0}),this.off(),this.destroyed()||(this.player.off(null,null,this),clearTimeout(this.timeoutAdStart),clearInterval(this.progressIntervalId),this.currentAd=null,this.options=null,this.adsLoaderManager.reset(null,!0),this.view.adTakeDown(),this.video=null,this.initAdsManagerPromise=null,this.instreamProvider.off(),this.instreamProvider.setProxy(null),this.instreamProvider=null,this.view=null,this.player=null)}destroyed(){return!this.player}}let Ne=null;const He=function(e,t){e.getContainer().querySelectorAll(".jw-icon-fullscreen").forEach((s=>{e.utils.style(s,{display:t})}))};class $e extends xe{constructor(t,s,i,n,a,r,o,l,d,h){super(t,s,i,n,h),t.utils.extend(this,t.Events),this.client=e,this.config=n,this.options=a,this.player=t,this.utils=t.utils,this.adsLoaderManager=l,this.view=o,this.qoe=new t.utils.Timer,this.instreamProvider=r,this.vmapPromise=Promise.resolve(),this.fullscreenIcon=t.getContainer().querySelector(".jw-icon-fullscreen"),this.video=d,this.hasPreroll=!0,this.reason=null}checkPreroll(e){this.adsLoaderManager.initializeDisplay({restrict:!0}),this.reason=null!=e&&e.playReason?e.playReason:u,super.checkPreroll(e)}checkPostrolls(e){this.schedule.isVMAP()&&this.adsPlayer?this.adsPlayer.beforeComplete():super.checkPostrolls(e)}createAdsPlayer(e){this.adsPlayer&&!this.adsPlayer.destroyed()||(this.adsPlayer=new Ve(this,this.reason),this.adsPlayer.on("all",((t,s)=>"allAdsComplete"===t?(this.adsPlayer.destroy(),void(this.adsPlayer=null)):"stopBlocking"===t?(this.stopBlocking(null==s?void 0:s.isNonlinear),void(!e&&s&&s.isDestroyed&&(this.adsPlayer=null))):void("adError"!==t?(this.dequeueAdEvents(),this.trigger(t,s)):this.enqueueAdEvent(t,s,{preload:e})))))}initAdsPlayer(e,s,i){return e===t&&(this.reason=u),this.createAdsPlayer(i._preload),this.player.on("resize",(()=>this.adsPlayer.resize()),this.adsPlayer).on("fullscreen",(()=>this.adsPlayer.resize()),this.adsPlayer),this.adsPlayer.init(e,s,i).then((e=>{this.trigger("adsManager",{adsManager:e,videoElement:this.video})}))}adLoadRequest(e,i){const n=this.utils.extend({},this.config);n.ad=e,this.offset=e.offset||this.offset,n.adPosition=qe(this.player);const a=new Ie(n,this.utils),r=i?s:t,o=this.initAdsPlayer(r,a,e);return je().then((()=>(this.adsPlayer.requestAds(),o)))}dequeueAdEvents(){this._events.forEach((({type:e,event:t})=>{this.trigger(e,t)})),this._events.splice(0)}triggerAdBreakEvents(e,t){var s;e._position=e._position||t,this.blockingInstreamPlayer.once("destroyed",(()=>{this.dequeueAdEvents(),this.trigger("adBreakEnd",De(this,null,e))}));const i=De(this,null,e);this.trigger("adBreakStart",i),this.dequeueAdEvents(),null!=this&&null!=(s=this.adsPlayer)&&s.destroyed()&&this.stopBlocking()}startBlocking(e){if(this.blockingInstreamPlayer||this.destroyed())return;!function(e){if(Ne=e.getEnvironment(),!Ne.OS.iOS||Ne.Browser.version.major<10)return;const t=e.getContainer();t.requestFullscreen||t.webkitRequestFullscreen||(e.getFullscreen()&&e.setFullscreen(!1),He(e,"none"))}(this.player),this.qoe.tick("adLoading"),this.utils.addClass(this.player.getContainer(),i),this.blockingInstreamPlayer=this.player.createInstream().init();const t=e?"":this.options.loadingAd;this.blockingInstreamPlayer.setText(t),this.blockingInstreamPlayer.applyProviderListeners(this.instreamProvider),this.adsPlayer&&!this.adsPlayer.destroyed()&&(this.adsPlayer.blockingInstreamPlayer=this.blockingInstreamPlayer),this.view.adSetup()}stopBlocking(e){var t;this.destroyed()||(this.player.off("viewable",null,this),t=this.player,He(t,""),this.utils.removeClass(this.player.getContainer(),[n,a,i]),this.blockingInstreamPlayer&&(this.instreamProvider.off(),this.blockingInstreamPlayer.destroy(),this.blockingInstreamPlayer=null),e||this.view.adTakeDown())}loadAd(e,t){if(e)return this.adsPlayer&&this.adsPlayer.scheduledAd!==e&&this.adsPlayer.destroy(),e._preload=!0,this.adLoadRequest(e,t)}playPreloadedPromise(e){e.then((()=>this.adsPlayer.startAdsLoader(this.blockingInstreamPlayer))).catch((()=>{this.stopBlocking()}))}startAdBreak(e,t){e&&(((e,t)=>{let s;try{s=new URL(e._adQueue[0],window.location).protocol}catch(e){}"https:"!==s&&"https:"===window.location.protocol&&t.trigger(v,{message:"VPAID insecure request was blocked.",code:901,adErrorCode:50005})})(e,this.player),this.adsPlayer&&this.adsPlayer.scheduledAd!==e&&this.adsPlayer.destroy(),this.startBlocking(),this.dequeueAdEvents(),this.adLoadRequest(e,t).then((()=>{this.adsPlayer.startAdsLoader(this.blockingInstreamPlayer)})).catch((()=>{this.stopBlocking()})))}destroy(){this.stopBlocking();const e=this.adsLoaderManager;e&&(e.reset(),this.adsLoaderManager=null),this.adsPlayer&&this.adsPlayer.destroy(),this.adsPlayer=null,super.destroy()}destroyed(){return null===this.adsLoaderManager}}class ze{constructor(e,t){this.adsLoader=null,this.adDisplayContainer=null,this.displayInitialized=!1,this.initialized=!1,this.started=!1,this.adsRequest=null,this.userRequestContext=null,this.adsManager=null,this.adsLoaderEvents={},this.adsManagerEvents={},this.container=t,this.schedule=null,this.breakMap={},this.player=e,this.environment=e.getEnvironment()}getVpaidMode(e){const t=google.ima.ImaSdkSettings.VpaidMode;return"disabled"===e||"none"===e?t.DISABLED:"enabled"===e?t.ENABLED:t.INSECURE}initializeDisplay(e){this.adDisplayContainer&&!this.displayInitialized&&(this.adDisplayContainer.initialize(),null!=e&&e.restrict&&(this.displayInitialized=!0))}contentComplete(){this.adsLoader&&this.adsLoader.contentComplete()}reset(e,t){if(t){this.adsRequest=null,this.userRequestContext=null;const e=this.adsManager;e&&(e.destroy(),this.adsManager=null),this.adsManagerEvents={},Object.keys(this.adsLoaderEvents).forEach((e=>{this.adsLoader.removeEventListener(e,this.adsLoaderEvents[e])})),this.adsLoaderEvents={}}else this.contentComplete();e&&(this.schedule=null,this.breakMap={}),this.initialized=this.started=!1}prepare(e,t){const s=google.ima.settings;s.setDisableCustomPlaybackForIOS10Plus(!0);const i=t.locale||this.player.getConfig().language;s.setLocale(i);const n=t.ppid;return n&&s.setPpid(n),"enabled"===t.omidSupport&&s.setFeatureFlags({enableOmidBeta:!0}),t.maxRedirects>=0&&s.setNumRedirects(t.maxRedirects),null===this.adsLoader&&(this.adDisplayContainer=new google.ima.AdDisplayContainer(this.container,e),this.adsLoader=new google.ima.AdsLoader(this.adDisplayContainer)),this.adsLoader}open(e,t,s){const i=this.prepare(s,t);return new Promise(((e,t)=>{i.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,t,!1),i.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,e,!1),this.adsLoaderEvents[google.ima.AdErrorEvent.Type.AD_ERROR]=t,this.adsLoaderEvents[google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED]=e}))}requestAds(e,t,s,i){if(null!==this.adsRequest)return;if(!i)return;const n=this.player,a=this.adsRequest=new google.ima.AdsRequest,r=this.userRequestContext={requestType:e,vpaidMode:t.vpaidmode,playerVersion:n.version.split("+")[0],adPosition:t.adPosition};a.setAdWillAutoPlay(!1!==n.getConfig().autostart),a.setAdWillPlayMuted(n.getMute());const o=n.getSafeRegion(!1);a.linearAdSlotWidth=o.width,a.linearAdSlotHeight=o.height;const l=n.getSafeRegion(!0);a.nonLinearAdSlotWidth=l.width,a.nonLinearAdSlotHeight=l.height,a.forceNonLinearFullSlot=s.forceNonLinearFullSlot,a.vastLoadTimeout=s.vastLoadTimeout,"enabled"===t.omidSupport&&(a.omidAccessModeRules=t.omidAccessModeRules);const d=this.adsLoader.getSettings(),h=this.getVpaidMode(r.vpaidMode);if(d.setPlayerType("jwplayer"),d.setPlayerVersion(r.playerVersion),d.setVpaidMode(h),i._pod)a.adsResponse=r.adsResponse=((e,t)=>{const s=document.implementation.createDocument("http://www.iab.net/videosuite/vmap","vmap:VMAP",null),i=s.documentElement;return i.setAttribute("version","1.0"),e.forEach((e=>{const n=s.createElement("vmap:AdTagURI");n.appendChild(s.createCDATASection(e));const a=i.appendChild(s.createElement("vmap:AdBreak")),r=`${t}`.replace("pre","start").replace("post","end");a.setAttribute("timeOffset",r);const o=a.appendChild(s.createElement("vmap:AdSource"));o.setAttribute("allowMultipleAds","true"),o.setAttribute("followRedirects","true"),o.appendChild(n)})),i.outerHTML||(new XMLSerializer).serializeToString(i)})(i._pod,i._offSet);else if(i.adm||i._adXML)a.adsResponse=r.adsResponse=i.adm||i._adXML;else if(i.tag||i._adQueue&&1===i._adQueue.length){const e=i.tag||i._adQueue[0];a.adTagUrl=r.adTagUrl=e.trim()}else{var u;const e=null!=i&&null!=(u=i._adQueue)&&u.length?(e=>{const t=document.implementation.createDocument("http://www.w3.org/2001/XMLSchema-instance","VAST",null),s=t.documentElement;return s.setAttribute("version","2.0"),e.forEach(((e,i)=>{const n=t.createElement("Ad");n.setAttribute("id",i);const a=t.createElement("Wrapper"),r=t.createElement("Extensions"),o=t.createElement("Extension");o.setAttribute("type","waterfall"),o.setAttribute("fallback_index",i);const l=t.createElement("VASTAdTagURI");l.appendChild(t.createCDATASection(e)),n.appendChild(a),a.appendChild(l),a.appendChild(r),r.appendChild(o),s.appendChild(n)})),s.outerHTML||(new XMLSerializer).serializeToString(s)})(i._adQueue):i.xml;a.adsResponse=r.adsResponse=e}this.adsLoader.requestAds(a,r)}getAdsManager(e,t,s){const i=new google.ima.AdsRenderingSettings;i.enablePreloading=s.enablePreloading||s.preloadAds,i.loadVideoTimeout=s.loadVideoTimeout,i.uiElements=null,i.useStyledNonLinearAds=!0,this.environment.OS.android&&this.environment.Browser.chrome&&this.environment.Browser.version.major>=84&&(i.mimeTypes=["video/mp4","video/webm","audio/mp4","audio/webm"]);const n=this.player.getConfig().bandwidthEstimate;if(i.bitrate=n?n/1e3:-1,s.customUi){s.customUi.disableUi&&(i.disableUi=!0)}return this.adsManager=e.getAdsManager(t,i),this.userRequestContext=e.getUserRequestContext(),this.adsManager}init(e,t,s){null!==this.adsManager&&!1===this.initialized&&(this.adsManager.init(e,t,s),this.initialized=!0)}start(){null!==this.adsManager&&!1===this.started&&(this.initializeDisplay({restrict:!0}),this.adsManager.start(),this.started=!0)}bindEvents(e){const t=google.ima.AdEvent.Type,s=google.ima.AdErrorEvent.Type;Object.keys(e).forEach((i=>{const n=t[i]||s[i],a=this.adsManagerEvents[n];a&&this.adsManager.removeEventListener(n,a),this.adsManager.addEventListener(n,e[i],!1),this.adsManagerEvents[n]=e[i]}))}unbindEvents(e){const t=google.ima.AdEvent.Type,s=google.ima.AdErrorEvent.Type;e.forEach((e=>{const i=t[e]||s[e],n=this.adsManagerEvents[i];n&&(this.adsManager.removeEventListener(i,n),delete this.adsManagerEvents[i])}))}getTag(e){if("string"==typeof this.schedule)return this.schedule;const t=Be(e,"getAdPodInfo");if(t){const e=this.breakMap[Be(t,"getTimeOffset")]||{};if(e.tag)return e.tag}return this.userRequestContext?this.userRequestContext.adTagUrl||this.userRequestContext.adsResponse||"":(console.error("invalid request context",this.userRequestContext),"")}getJwpSeg(e){const t=Be(e,"getAdPodInfo");if(t){var s,i;const e=Be(t,"getTimeOffset");return null==this||null==(s=this.breakMap)||null==(i=s[e])?void 0:i.jwpseg}return null}_getTimeoffsetFromPosition(){const e=this.player.getPosition();let t,s=1/0;return Object.keys(this.breakMap).forEach((i=>{const n=e-i;n>=0&&n<s&&(t=i,s=n)})),s===1/0?-1:t}skipAd(){this.adsManager&&this.adsManager.skip()}getBid(e){const t=Q(e,this.player.utils);return this.breakMap[t]?this.breakMap[t].bid:null}setBid(e,t){const s=Q(e,this.player.utils);this.breakMap[s]=this.breakMap[s]||{},this.breakMap[s].bid=t}}const Qe={},We={},Ge={},Je=(e,t)=>{const s=Qe[t];return s||(Qe[t]=new Promise(((s,i)=>{const n=new e.key(t);if("unlimited"===n.edition())return i();const a=["//","entitlements.jwplayer.com","/",n.token(),".json"];"file:"===window.location.protocol&&a.unshift("https:"),e.ajax(a.join(""),(function(e){const t=null==e?void 0:e.response;t?s(t):i()}),(function(){i()}),{timeout:1e4,responseType:"json"})})))},Xe=(e,t)=>{const s=We[t];return s||(We[t]=Je(e,t).catch((()=>({}))).then((e=>{if(!1===e.canUseVPB)throw new Error("Not entitled for Player Bidding")})))},Fe=(e,t,s)=>{const i=Ge[t];return i||(Ge[t]=Je(e,t).catch((()=>({}))).then((e=>{let t,i;if(!0===s.outstream?(t=!1!==e.canPlayOutstreamAds,i="Outstream Ad Limit Reached"):(t=!1!==e.canPlayAds,i="Ad Limit Reached"),!1===t)throw new Error(i);return{message:"Can Play Ads"}})))},Ke=function(){};var Ye="8.10.0";!function(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");t.setAttribute("media","screen"),t.innerHTML=e,document.head.appendChild(t)}}(".jw-plugin-googima{overflow:hidden;width:100%;height:100%;display:block;visibility:hidden;pointer-events:none;opacity:0}.jw-plugin-googima.jw-ad-instream{visibility:visible;display:block;pointer-events:all;opacity:1}.jw-plugin-googima.jw-ad-instream .jw-ads-view>:not(div),.jw-plugin-googima.jw-ad-instream .jw-ads-view>div:not(:empty){width:100%;height:100%}.jw-plugin-googima.jw-ad-linear{top:0;left:0;bottom:0}.jw-plugin-googima.jw-ad-non-linear{top:auto}.jw-plugin-googima .jw-ads-view{position:absolute;width:100%;height:100%}.jwplayer.jw-flag-ads-googleima.jw-flag-touch .jw-controlbar{font-size:1em}.jwplayer.jw-flag-ads-googleima.jw-flag-touch .jw-display-icon-display,.jwplayer.jw-flag-ads-googleima.jw-flag-touch .jw-display-icon-display .jw-icon-display{pointer-events:none}.jwplayer.jw-flag-ads-googleima .jw-controlbar{background:0 0!important;pointer-events:none}.jwplayer.jw-flag-ads-googleima .jw-controlbar .jw-horizontal-volume-container{pointer-events:auto}.jwplayer.jw-flag-ads-googleima .jw-controlbar .jw-icon{pointer-events:all}.jwplayer.jw-flag-ads-googleima .jw-controlbar .jw-icon-fullscreen:not(.jw-fullscreen-ima){display:none}.jwplayer.jw-flag-ads-googleima .jw-controlbar .jw-fullscreen-ima{display:flex}.jwplayer.jw-flag-ads-googleima .jw-controls-backdrop{display:none}.jwplayer.jw-flag-ads-googleima.jw-ie .jw-slider-volume,.jwplayer.jw-flag-ads-googleima.jw-ie .jw-svg-icon{background:rgba(0,0,0,.25);border-radius:3px}.jwplayer.jw-flag-ads-googleima.jw-ie .jw-slider-volume{margin:0 10px}@supports (filter:drop-shadow(0 0 3px #000)){.jwplayer.jw-flag-ads-googleima.jw-ie .jw-slider-volume,.jwplayer.jw-flag-ads-googleima.jw-ie .jw-svg-icon{background:0 0;border-radius:0}.jwplayer.jw-flag-ads-googleima.jw-ie .jw-slider-volume{margin:0}}.jwplayer.jw-flag-ads-googleima .jw-controlbar .jw-svg-icon{fill:#fff;filter:drop-shadow(0 0 3px #000)}.jwplayer.jw-flag-ads-googleima .jw-controlbar .jw-text{text-shadow:0 0 3px #000}.jwplayer.jw-flag-ads-googleima.jw-flag-small-player.jw-flag-ads.jw-state-playing.jw-flag-touch:not(.jw-flag-ads-vpaid) .jw-controls .jw-controlbar{pointer-events:none}.jwplayer.jw-flag-ads-googleima.jw-flag-small-player .jw-controlbar{flex-flow:column-reverse nowrap;height:100%;max-height:none}.jwplayer.jw-flag-ads-googleima.jw-flag-small-player .jw-button-container{align-items:flex-end;flex-wrap:wrap;margin-bottom:7px}.jwplayer.jw-flag-ads-googleima.jw-flag-small-player .jw-controlbar .jw-icon{height:30px}.jwplayer.jw-flag-ads-googleima.jw-flag-small-player .jw-text{align-self:flex-start;margin:16px 0 0 16px;order:-1;width:100%}");(window.jwplayerPluginJsonp||window.jwplayer().registerPlugin)(e,"8.1",class{constructor(t,s,i,n){this.player=t,this.player.utils.extend(this,this.player.Events),this.pluginConfig=s,this.div=i,this.configScheduleParser=new _e(this.player,this.pluginConfig,e),this.options=new Ie(this.pluginConfig||{},this.player.utils),this.adRules=this.configScheduleParser.getAdRules(),this.videoElement=null,this.playlistItemEventCount=0,this.nextPlaylistItemManager=null,this.nextPlaylistRelated=!1,this.casting=!1,this.bidsBlock=this.pluginConfig.bids,n&&n.sdkPromise&&n.checkEntitlements?(n.checkEntitlements(),n.sdkPromise()):(!function(e,t,s,i){const n=t.key,a=e.utils,r=Fe(a,n,s);let o;r.catch(Ke),s.bids&&(o=Xe(a,n),o.catch(Ke)),e.on("ready",(()=>{o&&o.catch((s=>{e.trigger("destroyBidding"),e.trigger(v,we(s.message,60009,t,i))})),r.catch((s=>{e.trigger("destroyPlugin",s),e.trigger(v,we(s.message,60002,t,i))}))}))}(this.player,this.player.getConfig(),this.pluginConfig,e),je(this.player.utils).catch(this.player.utils.noop)),this.view=new Re(this.div,this.player.id,this.player.utils),this.instreamProvider=new Le(this.player.utils,this.player.Events,this.view),this.adsLoader=new ze(this.player,this.view.getAdDiv()),this.playlistItemManager=null,this.version=Ye,this.player.pauseAd=this.pauseAd.bind(this),this.player.playAd=this.playAd.bind(this),this.player.skipAd=this.skipAd.bind(this),this.player.on("ready",this.onReadyCallback,this),this.player.on("playlistItem",this.onPlaylistItemCallback,this),this.player.on("playlistComplete",this.onPlaylistCompleteCallback,this),this.player.on("cast",this.onCastCallback,this),this.player.on("mute",this.onMuteCallback,this),this.player.on("destroyPlugin",this.onDestroyPlugin,this),this.player.on("destroyBidding",this.onDestroyBidding,this)}adsDebugMode(){this.options.debug=!0,this.playlistItemManager&&(this.playlistItemManager.debugConsoleLog=function(...e){console.log(e)})}getCompanions(e,t,s,i){try{return e.getCompanionAds(t,s,i)}catch(e){return[]}}addCompanionsToDOM(e){if(!e||!e.length)return;const t=document.getElementById(this.options.companiondiv.id);if(!t)return;const s=e[0];s&&("function"==typeof s.getContent?t.innerHTML=s.getContent():t.innerHTML=s.resource||s.content)}convertCompanions(e){const t=[];for(let s=0;s<e.length;s++){const i=e[s];t.push({width:i.getWidth(),height:i.getHeight(),type:"html",resource:i.getContent()})}return t}manageCompanionAd(e){const t=e.currentAd;let s=new google.ima.CompanionAdSelectionSettings;s.sizeCriteria=google.ima.CompanionAdSelectionSettings.SizeCriteria.IGNORE;const i=this.options.companiondiv||{width:300,height:250},n=this.convertCompanions(this.getCompanions(t,i.width,i.height,s));let a=n.length;if(a){const s=De(this.playlistItemManager,t,e.scheduledAd);s.companions=n,this.player.trigger("adCompanions",s)}if(this.options.companiondiv){s=new google.ima.CompanionAdSelectionSettings,this.options.companionResourceType&&(s.resourceType=google.ima.CompanionAdSelectionSettings.ResourceType[this.options.companionResourceType]);const e=this.getCompanions(t,this.options.companiondiv.width,this.options.companiondiv.height,s);a=Math.max(a,e.length),this.addCompanionsToDOM(e)}return a>0}destroyPlugin(){var e;this.destroy(),null!=this&&null!=(e=this.adsLoader)&&e.adDisplayContainer&&this.adsLoader.adDisplayContainer.destroy(),this.player.off(null,null,this),this.player.playAd=this.player.utils.noop,this.player.pauseAd=this.player.utils.noop}resetSchedule(e){var t;null!=this&&null!=(t=this.playlistItemManager)&&t.adsPlayer&&this.playlistItemManager.adsPlayer.discardAdBreak(),this.adsLoader.contentComplete(),this.destroy(e),function(e){const t=e.getCues();if(Array.isArray(t)&&t.length){const s=t.filter((e=>"ads"!==e.cueType));e.setCues(s)}}(this.player)}createPlaylistItemManager(e,t,i,n){const a=e.item||{},r=this.configScheduleParser.getSchedule(a,i.playlistItemEventCount),o=new(null!=n&&n.PlaylistItemManager?n.PlaylistItemManager:$e)(this.player,r,a,this.pluginConfig,this.options,this.instreamProvider,this.view,this.adsLoader,this.videoElement,this.casting);return o.on("all",((e,t)=>{if("preloadNext"!==e)this.player.trigger(e,t);else{const e=Object.assign({},i,{preloadPreroll:!0,playlistItemEventCount:this.playlistItemEventCount+1});o.next=this.createPlaylistItemManager(t,s,e)}})),o.init(this.bidsBlock,i),o.on(d,(()=>this.manageCompanionAd(o.adsPlayer))),o}handlePlaylistItem(e,t,i,n){null!=n&&n.sdkPromise?n.sdkPromise():je(this.player.utils).then((()=>{this.adsLoader.prepare(this.videoElement,i)}));const a=e.item||this.player.getPlaylistItem(e.index);this.resetSchedule(!0);const r=this.configScheduleParser.getSchedule(a,this.playlistItemEventCount);!(t===s&&!this.adRules.rulesAllowAdPlayback(this.playlistItemEventCount))&&r&&(r.getAllAds().length||r.isVMAP())&&(this.nextPlaylistItemManager&&a!==this.nextPlaylistItemManager.item&&!1===this.nextPlaylistRelated&&(this.nextPlaylistItemManager.off(null,null,this),this.nextPlaylistItemManager.destroy(),this.nextPlaylistItemManager=null),this.adsLoader.reset(!0),this.playlistItemManager=this.nextPlaylistItemManager||this.createPlaylistItemManager(e,t,i),this.playlistItemManager.attachListeners(),this.nextPlaylistItemManager=null,this.nextPlaylistRelated=!1)}pauseAd(e,t){var s;null!=this&&null!=(s=this.playlistItemManager)&&s.adsPlayer&&(e?this.playlistItemManager.adsPlayer.pause(t||{}):this.playlistItemManager.adsPlayer.resume(t||{}))}playAd(e,s){const i=this.player.utils.extend({},this.pluginConfig);let n;n=this.player._.isArray(e)?e.slice(0):[e];const a=new(null!=s&&s.Options?s.Options:Ie)(i,this.player.utils);a.setLocalizationOptions(this.player.getConfig().localization.advertising);const r=this.playlistItemManager?this.playlistItemManager.blockingInstreamPlayer:null;r&&(r.noResume=!0),this.destroy(),this.playlistItemManager=this.createPlaylistItemManager({item:this.player.getPlaylistItem()},t,a),this.playlistItemManager&&!this.playlistItemManager.destroyed()&&this.playlistItemManager.startAdBreak({_adQueue:n,_position:qe(this.player),adBreakId:this.player.utils.genId(12)})}skipAd(){this.adsLoader&&this.adsLoader.skipAd()}onReadyCallback(e){this.options.setLocalizationOptions(this.player.getConfig().localization.advertising),this.videoElement||(this.videoElement=this.player.createInstream().getMediaElement()),null!=e&&e.sdkPromise?e.sdkPromise():je(this.player.utils).catch((e=>{e.message.match(/Failed to load/)&&this.handleDependencyError("Ad playback blocked by an ad blocker",2e4)}));const t=document.body;this.primeAdDisplay=()=>{t.removeEventListener("mouseup",this.primeAdDisplay),t.removeEventListener("touchend",this.primeAdDisplay),this.adsLoader.initializeDisplay(),this.primeAdDisplay=null},t.addEventListener("mouseup",this.primeAdDisplay,!1),t.addEventListener("touchend",this.primeAdDisplay,!1)}onPlaylistItemCallback(e){this.playlistItemEventCount++;const t=Object.assign({playlistItemEventCount:this.playlistItemEventCount},this.options);this.handlePlaylistItem(e,s,t),this.playlistItemManager&&!this.playlistItemManager.schedule.isVMAP()&&this.sendCues(this.playlistItemManager.schedule)}onPlaylistCompleteCallback(){this.resetSchedule(!0)}onCastCallback(e){this.casting=Boolean(e.active),e.active&&this.resetSchedule()}onMuteCallback(e){this.instreamProvider.mute(e)}onDestroyPlugin(){this.destroy()}onDestroyBidding(){this.bidsBlock=null}sendCues(e){const t=e.getMidRolls(),s=[];t.length&&t.forEach((e=>{"nonlinear"!==e._type&&s.push({begin:e._offSet,text:this.options.cuetext,cueType:"ads"})})),this.player.addCues(s)}destroy(e){this.playlistItemManager&&(e&&(this.nextPlaylistItemManager=this.playlistItemManager.next,this.nextPlaylistRelated=this.playlistItemManager.nextPlaylistRelated),this.playlistItemManager.off(null,null,this),this.playlistItemManager.destroy(),this.playlistItemManager=null),this.primeAdDisplay&&(document.body.removeEventListener("mouseup",this.primeAdDisplay),document.body.removeEventListener("touchend",this.primeAdDisplay)),this.configScheduleParser.reset()}handleDependencyError(e,t){this.destroyPlugin(),this.player.trigger(o,Oe(null,{message:e,adErrorCode:t,id:"-1",placement:$(this.player.getConfig()),tag:""}))}})}();
